<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Semina AR — Place Your Plant</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    :root {
      --green: #2F5233;
      --green-light: #3A6B3F;
      --green-pale: rgba(47, 82, 51, 0.15);
      --white: #ffffff;
      --glass: rgba(20, 20, 20, 0.75);
      --glass-light: rgba(255,255,255,0.12);
      --radius: 20px;
      --font: 'DM Sans', sans-serif;
    }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      background: #000;
      font-family: var(--font);
    }

    /* ── CAMERA BG ── */
    #camera-bg {
      position: fixed; inset: 0;
      background: #111;
      overflow: hidden;
    }

    #video {
      width: 100%; height: 100%;
      object-fit: cover;
      filter: saturate(0.85) brightness(0.9);
    }

    /* ── SCREENS ── */
    .screen {
      position: fixed; inset: 0;
      display: none;
      flex-direction: column;
      pointer-events: none;
    }
    .screen.active { display: flex; pointer-events: all; }

    /* ── TOP BAR ── */
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 56px 20px 0;
      z-index: 10;
    }

    .location-chip {
      display: flex; align-items: center; gap: 8px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-light);
      border-radius: 50px;
      padding: 10px 18px;
      color: white;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.2px;
    }

    .location-chip svg { width: 16px; height: 16px; opacity: 0.8; }

    .top-actions {
      display: flex; gap: 10px;
    }

    .icon-btn {
      width: 48px; height: 48px;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-light);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      color: white;
      transition: all 0.2s;
    }
    .icon-btn:active { transform: scale(0.92); }
    .icon-btn svg { width: 20px; height: 20px; }

    /* ── SCREEN 1: SCANNING ── */
    #screen-scan .middle {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* Reticle */
    .reticle {
      width: 120px; height: 120px;
      position: relative;
      animation: reticle-pulse 2s ease-in-out infinite;
    }

    @keyframes reticle-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }

    .reticle-corner {
      position: absolute;
      width: 28px; height: 28px;
      border-color: white;
      border-style: solid;
    }
    .reticle-corner.tl { top: 0; left: 0; border-width: 3px 0 0 3px; border-radius: 8px 0 0 0; }
    .reticle-corner.tr { top: 0; right: 0; border-width: 3px 3px 0 0; border-radius: 0 8px 0 0; }
    .reticle-corner.bl { bottom: 0; left: 0; border-width: 0 0 3px 3px; border-radius: 0 0 0 8px; }
    .reticle-corner.br { bottom: 0; right: 0; border-width: 0 3px 3px 0; border-radius: 0 0 8px 0; }

    .reticle-icon {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
    }
    .reticle-icon svg { width: 36px; height: 36px; color: white; opacity: 0.9; }

    /* Scan line animation */
    .scan-line {
      position: absolute;
      left: 50%; top: 30%;
      transform: translateX(-50%);
      width: 200px; height: 2px;
      background: linear-gradient(90deg, transparent, #4ade80, transparent);
      animation: scan 2s ease-in-out infinite;
      border-radius: 2px;
    }
    @keyframes scan {
      0% { top: 25%; opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { top: 75%; opacity: 0; }
    }

    /* Grid overlay */
    .grid-overlay {
      position: absolute; inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
      background-size: 80px 80px;
      pointer-events: none;
    }

    /* Progress card */
    .progress-card {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: var(--glass);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--glass-light);
      border-radius: var(--radius);
      padding: 16px 20px;
      min-width: 240px;
      display: none;
      animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .progress-card.show { display: block; }

    @keyframes slideUp {
      from { opacity: 0; transform: translate(-50%, -40%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .progress-card-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 8px;
    }

    .progress-location {
      display: flex; align-items: center; gap: 8px;
      color: white; font-size: 17px; font-weight: 700;
    }

    .progress-check {
      width: 22px; height: 22px;
      background: #4ade80;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
    }

    .progress-check svg { width: 12px; height: 12px; color: white; }

    .progress-next {
      width: 32px; height: 32px;
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .progress-next svg { width: 16px; height: 16px; color: white; }

    .progress-sub {
      color: rgba(255,255,255,0.6);
      font-size: 13px;
      font-weight: 400;
    }

    /* Progress dots */
    .progress-dots {
      display: flex; gap: 6px;
      margin-top: 10px;
    }
    .progress-dot {
      height: 4px; border-radius: 2px;
      background: rgba(255,255,255,0.25);
      transition: all 0.5s ease;
    }
    .progress-dot.active { background: #4ade80; }
    .progress-dot.done { background: rgba(74, 222, 128, 0.5); }

    /* ── 3D PLANT (CSS) ── */
    .ar-plant-container {
      position: absolute;
      bottom: 38%;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      flex-direction: column;
      align-items: center;
      animation: plantAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .ar-plant-container.show { display: flex; }

    @keyframes plantAppear {
      from { opacity: 0; transform: translateX(-50%) scale(0.3); }
      to { opacity: 1; transform: translateX(-50%) scale(1); }
    }

    /* Shadow plane */
    .plant-shadow {
      width: 120px; height: 20px;
      background: radial-gradient(ellipse, rgba(0,0,0,0.4) 0%, transparent 70%);
      margin-top: -10px;
      filter: blur(4px);
    }

    /* Green highlight plane */
    .surface-plane {
      position: absolute;
      bottom: 30%;
      left: 50%;
      transform: translateX(-50%) perspective(300px) rotateX(60deg);
      width: 180px; height: 100px;
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.25), rgba(47, 82, 51, 0.2));
      border: 1px solid rgba(74, 222, 128, 0.4);
      border-radius: 8px;
      display: none;
    }
    .surface-plane.show { display: block; }

    /* Plant SVG */
    .plant-svg {
      width: 100px; height: 130px;
      filter: drop-shadow(0 8px 20px rgba(0,0,0,0.5));
    }

    /* Movement toast */
    .movement-toast {
      position: absolute;
      bottom: 28%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--glass);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--glass-light);
      border-radius: 18px;
      padding: 14px 20px;
      display: none;
      align-items: center;
      gap: 14px;
      min-width: 260px;
      animation: toastIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .movement-toast.show { display: flex; }

    @keyframes toastIn {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    .toast-icon {
      width: 44px; height: 44px;
      background: white;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .toast-icon svg { width: 22px; height: 22px; color: #111; }

    .toast-text {
      color: white;
    }
    .toast-title { font-size: 16px; font-weight: 700; }
    .toast-sub { font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 2px; }

    /* Direction arrows */
    .direction-arrows {
      position: absolute;
      display: none;
      pointer-events: none;
    }
    .direction-arrows.show { display: block; }
    .arrow-chevron {
      color: rgba(74, 222, 128, 0.7);
      animation: arrowPulse 0.8s ease-in-out infinite;
    }
    .arrow-chevron:nth-child(2) { animation-delay: 0.15s; opacity: 0.5; }
    .arrow-chevron:nth-child(3) { animation-delay: 0.3s; opacity: 0.3; }

    @keyframes arrowPulse {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(-6px); }
    }

    /* ── SCREEN 2: CUSTOMIZE ── */
    #screen-customize {
      justify-content: flex-end;
    }

    .bottom-sheet {
      background: white;
      border-radius: 28px 28px 0 0;
      padding: 12px 24px 40px;
      pointer-events: all;
      animation: sheetUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes sheetUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    .sheet-handle {
      width: 40px; height: 4px;
      background: #e5e5e5;
      border-radius: 2px;
      margin: 0 auto 20px;
    }

    .sheet-title {
      font-size: 17px;
      font-weight: 700;
      color: #111;
      margin-bottom: 14px;
    }

    .pot-options {
      display: flex; gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .pot-btn {
      padding: 10px 18px;
      border: 1.5px solid #e5e5e5;
      border-radius: 50px;
      background: white;
      font-size: 14px;
      font-weight: 500;
      color: #444;
      cursor: pointer;
      font-family: var(--font);
      transition: all 0.2s;
    }
    .pot-btn.active {
      border-color: var(--green);
      background: var(--green);
      color: white;
    }

    .size-row {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 12px;
    }
    .size-label { font-size: 15px; font-weight: 600; color: #111; }
    .size-value { font-size: 14px; color: #888; font-weight: 500; }

    .slider-track {
      position: relative;
      width: 100%;
      height: 6px;
      background: #e5e5e5;
      border-radius: 3px;
      margin-bottom: 28px;
    }

    .slider-fill {
      height: 100%;
      background: var(--green);
      border-radius: 3px;
      width: 60%;
      transition: width 0.1s;
    }

    input[type=range] {
      position: absolute;
      inset: -8px 0;
      width: 100%;
      opacity: 0;
      cursor: pointer;
      height: 22px;
    }

    .slider-thumb {
      position: absolute;
      top: 50%;
      left: 60%;
      transform: translate(-50%, -50%);
      width: 20px; height: 20px;
      background: white;
      border: 2px solid var(--green);
      border-radius: 50%;
      pointer-events: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      transition: left 0.1s;
    }

    .confirm-btn {
      width: 100%;
      padding: 18px;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 17px;
      font-weight: 700;
      font-family: var(--font);
      cursor: pointer;
      letter-spacing: -0.2px;
      transition: all 0.2s;
    }
    .confirm-btn:active { transform: scale(0.97); opacity: 0.9; }

    /* ── SCREEN 3: RECOMMENDATIONS ── */
    #screen-recommend {
      justify-content: flex-end;
    }

    .recommend-sheet {
      background: var(--glass);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid var(--glass-light);
      border-radius: 28px 28px 0 0;
      padding: 12px 24px 48px;
      animation: sheetUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .recommend-title {
      font-size: 20px;
      font-weight: 700;
      color: white;
      margin-bottom: 16px;
    }

    .plant-cards {
      display: flex; gap: 14px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .plant-cards::-webkit-scrollbar { display: none; }

    .plant-card {
      background: white;
      border-radius: 20px;
      padding: 16px;
      min-width: 160px;
      flex-shrink: 0;
      position: relative;
      overflow: visible;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .plant-card:active { transform: scale(0.96); }

    .plant-card-img {
      width: 80px; height: 80px;
      object-fit: contain;
      margin: -30px auto 8px;
      display: block;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
    }

    .plant-card-name {
      font-size: 16px;
      font-weight: 700;
      color: #111;
      margin-bottom: 2px;
    }

    .plant-card-status {
      font-size: 12px;
      font-weight: 600;
      color: #1F8A3D;
      margin-bottom: 6px;
    }

    .plant-card-desc {
      font-size: 12px;
      color: #888;
      line-height: 1.4;
    }

    /* Location complete banner */
    .location-banner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--glass);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--glass-light);
      border-radius: var(--radius);
      padding: 16px 20px;
      min-width: 280px;
      display: none;
    }
    .location-banner.show { display: block; }

    .location-banner-header {
      display: flex; align-items: center; justify-content: space-between;
    }

    .location-banner-title {
      font-size: 20px; font-weight: 700; color: white;
    }

    .location-banner-arrow {
      width: 36px; height: 36px;
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .location-banner-arrow svg { width: 18px; height: 18px; color: white; }

    .location-banner-sub {
      color: rgba(255,255,255,0.5);
      font-size: 13px;
      margin-top: 4px;
    }

    /* ── LOADING SCREEN ── */
    #screen-loading {
      background: #0a0a0a;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    .loading-logo {
      font-size: 28px;
      font-weight: 800;
      color: white;
      letter-spacing: -1px;
    }
    .loading-logo span { color: #4ade80; }

    .loading-spinner {
      width: 44px; height: 44px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #4ade80;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      color: rgba(255,255,255,0.4);
      font-size: 14px;
      font-weight: 400;
    }

    /* ── PERMISSION SCREEN ── */
    #screen-permission {
      background: #0a0a0a;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 40px;
      text-align: center;
    }

    .permission-icon {
      width: 80px; height: 80px;
      background: var(--green-pale);
      border-radius: 24px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 8px;
    }
    .permission-icon svg { width: 40px; height: 40px; color: #4ade80; }

    .permission-title {
      font-size: 24px; font-weight: 800;
      color: white; letter-spacing: -0.5px;
    }

    .permission-sub {
      font-size: 15px; color: rgba(255,255,255,0.5);
      line-height: 1.6; max-width: 280px;
    }

    .permission-btn {
      padding: 16px 40px;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 700;
      font-family: var(--font);
      cursor: pointer;
      margin-top: 8px;
    }

    /* ── UTILITIES ── */
    .hidden { display: none !important; }

    /* Haptic feedback simulation */
    @keyframes haptic {
      0% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
      100% { transform: translateX(0); }
    }
    .haptic { animation: haptic 0.1s ease; }
  </style>
</head>
<body>

<!-- Camera Background -->
<div id="camera-bg">
  <video id="video" autoplay playsinline muted></video>
</div>

<!-- ── SCREEN: LOADING ── -->
<div class="screen active" id="screen-loading">
  <div class="loading-logo">semi<span>na</span> AR</div>
  <div class="loading-spinner"></div>
  <div class="loading-text">Initializing camera…</div>
</div>

<!-- ── SCREEN: PERMISSION ── -->
<div class="screen" id="screen-permission">
  <div class="permission-icon">
    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
      <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
    </svg>
  </div>
  <div class="permission-title">Camera Access</div>
  <div class="permission-sub">Semina AR needs your camera to place plants in your real space.</div>
  <button class="permission-btn" onclick="requestCamera()">Enable Camera</button>
</div>

<!-- ── SCREEN: SCANNING ── -->
<div class="screen" id="screen-scan">
  <!-- Grid overlay -->
  <div class="grid-overlay"></div>

  <!-- Top bar -->
  <div class="topbar">
    <div class="location-chip">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
      </svg>
      Balcony
    </div>
    <div class="top-actions">
      <div class="icon-btn" title="Compass">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418" />
        </svg>
      </div>
      <div class="icon-btn" onclick="closeAR()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Middle: reticle + scan -->
  <div class="middle">
    <div class="reticle" id="reticle">
      <div class="reticle-corner tl"></div>
      <div class="reticle-corner tr"></div>
      <div class="reticle-corner bl"></div>
      <div class="reticle-corner br"></div>
      <div class="reticle-icon">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
        </svg>
      </div>
    </div>
    <div class="scan-line"></div>

    <!-- Progress card -->
    <div class="progress-card" id="progress-card">
      <div class="progress-card-header">
        <div class="progress-location">
          <div class="progress-check">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
          </div>
          Balcony
        </div>
        <div class="progress-next" onclick="nextScanStep()">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        </div>
      </div>
      <div class="progress-sub" id="progress-sub">1/3 surface Detected</div>
      <div class="progress-dots">
        <div class="progress-dot active" id="dot-1" style="flex:1"></div>
        <div class="progress-dot" id="dot-2" style="flex:1"></div>
        <div class="progress-dot" id="dot-3" style="flex:1"></div>
      </div>
    </div>

    <!-- Location complete banner (3/3) -->
    <div class="location-banner" id="location-banner">
      <div class="location-banner-header">
        <div class="location-banner-title">Balcony</div>
        <div class="location-banner-arrow" onclick="goToCustomize()">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25" />
          </svg>
        </div>
      </div>
      <div class="location-banner-sub">3/3 surface</div>
    </div>
  </div>

  <!-- AR Plant -->
  <div class="surface-plane" id="surface-plane"></div>
  <div class="ar-plant-container" id="ar-plant">
    <svg class="plant-svg" viewBox="0 0 100 130" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Pot -->
      <ellipse cx="50" cy="118" rx="22" ry="6" fill="#8B7355" opacity="0.4"/>
      <path d="M32 100 L35 120 L65 120 L68 100 Z" fill="#A0856A" rx="4"/>
      <ellipse cx="50" cy="100" rx="18" ry="5" fill="#B8966E"/>
      <path d="M34 100 Q34 96 50 96 Q66 96 66 100" fill="#C4A882"/>
      <!-- Soil -->
      <ellipse cx="50" cy="100" rx="16" ry="4" fill="#5C4033"/>
      <!-- Stem -->
      <path d="M50 100 L50 70" stroke="#4A7C59" stroke-width="4" stroke-linecap="round"/>
      <!-- Left big leaf -->
      <path d="M50 80 Q30 65 22 48 Q38 52 50 72" fill="#2E7D32" opacity="0.9"/>
      <path d="M50 80 Q30 65 22 48" stroke="#1B5E20" stroke-width="0.8" opacity="0.5"/>
      <!-- Right big leaf -->
      <path d="M50 75 Q70 58 78 40 Q62 46 50 68" fill="#388E3C" opacity="0.9"/>
      <path d="M50 75 Q70 58 78 40" stroke="#1B5E20" stroke-width="0.8" opacity="0.5"/>
      <!-- Center leaves -->
      <path d="M50 70 Q42 52 44 36 Q54 46 50 68" fill="#43A047"/>
      <path d="M50 70 Q58 50 56 32 Q47 44 50 68" fill="#4CAF50"/>
      <!-- Top small leaf -->
      <path d="M50 68 Q46 55 50 44 Q54 55 50 68" fill="#66BB6A"/>
      <!-- Leaf veins -->
      <path d="M50 80 Q36 67 28 52" stroke="#1B5E20" stroke-width="0.6" opacity="0.4"/>
      <path d="M50 75 Q64 62 72 46" stroke="#1B5E20" stroke-width="0.6" opacity="0.4"/>
    </svg>
    <div class="plant-shadow"></div>
  </div>

  <!-- Direction arrows (forward) -->
  <div class="direction-arrows" id="arrows-forward" style="bottom:36%;left:50%;transform:translateX(-50%)">
    <div style="display:flex;flex-direction:column;align-items:center;gap:2px">
      <svg class="arrow-chevron" width="32" height="20" viewBox="0 0 32 20" fill="currentColor">
        <path d="M16 0l16 16H0z"/>
      </svg>
      <svg class="arrow-chevron" width="32" height="20" viewBox="0 0 32 20" fill="currentColor">
        <path d="M16 0l16 16H0z"/>
      </svg>
      <svg class="arrow-chevron" width="32" height="20" viewBox="0 0 32 20" fill="currentColor">
        <path d="M16 0l16 16H0z"/>
      </svg>
    </div>
  </div>

  <!-- Direction arrows (left) -->
  <div class="direction-arrows" id="arrows-left" style="bottom:38%;left:30%;transform:translateX(-50%)">
    <div style="display:flex;flex-direction:row;align-items:center;gap:2px">
      <svg class="arrow-chevron" width="20" height="32" viewBox="0 0 20 32" fill="currentColor">
        <path d="M20 16L4 32V0z"/>
      </svg>
      <svg class="arrow-chevron" width="20" height="32" viewBox="0 0 20 32" fill="currentColor">
        <path d="M20 16L4 32V0z"/>
      </svg>
      <svg class="arrow-chevron" width="20" height="32" viewBox="0 0 20 32" fill="currentColor">
        <path d="M20 16L4 32V0z"/>
      </svg>
    </div>
  </div>

  <!-- Movement toast -->
  <div class="movement-toast" id="movement-toast">
    <div class="toast-icon" id="toast-icon">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5L12 3m0 0l7.5 7.5M12 3v18" />
      </svg>
    </div>
    <div class="toast-text">
      <div class="toast-title" id="toast-title">Move forward 12cm</div>
      <div class="toast-sub">Slowly pan your phone</div>
    </div>
  </div>
</div>

<!-- ── SCREEN: CUSTOMIZE ── -->
<div class="screen" id="screen-customize">
  <!-- Top bar -->
  <div class="topbar">
    <div class="location-chip">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
      </svg>
      Balcony
    </div>
    <div class="top-actions">
      <div class="icon-btn">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3" />
        </svg>
      </div>
      <div class="icon-btn" onclick="closeAR()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </div>
    </div>
  </div>

  <div style="flex:1"></div>

  <!-- Bottom sheet -->
  <div class="bottom-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">Change Pot</div>
    <div class="pot-options">
      <button class="pot-btn active" onclick="selectPot(this)">plastic</button>
      <button class="pot-btn" onclick="selectPot(this)">clay</button>
      <button class="pot-btn" onclick="selectPot(this)">ceramic</button>
      <button class="pot-btn" onclick="selectPot(this)">grow bag</button>
    </div>
    <div class="size-row">
      <div class="size-label">Size</div>
      <div class="size-value" id="size-label">60%</div>
    </div>
    <div class="slider-track">
      <div class="slider-fill" id="slider-fill"></div>
      <div class="slider-thumb" id="slider-thumb"></div>
      <input type="range" min="10" max="100" value="60" oninput="updateSlider(this)"/>
    </div>
    <button class="confirm-btn" onclick="goToRecommend()">Confirm Plant</button>
  </div>
</div>

<!-- ── SCREEN: RECOMMENDATIONS ── -->
<div class="screen" id="screen-recommend">
  <!-- Top bar -->
  <div class="topbar">
    <div class="location-chip">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
      </svg>
      Balcony
    </div>
    <div class="top-actions">
      <div class="icon-btn">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3" />
        </svg>
      </div>
      <div class="icon-btn" onclick="closeAR()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Location complete card -->
  <div style="padding: 0 20px; margin-top: 20px;">
    <div style="background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-light);border-radius:20px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="font-size:20px;font-weight:700;color:white;">Balcony</div>
        <div style="font-size:13px;color:rgba(255,255,255,0.5);margin-top:2px;">3/3 surface</div>
      </div>
      <div class="icon-btn" onclick="goToCustomize()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25" />
        </svg>
      </div>
    </div>
  </div>

  <div style="flex:1"></div>

  <!-- Recommend sheet -->
  <div class="recommend-sheet">
    <div class="sheet-handle" style="background:rgba(255,255,255,0.2)"></div>
    <div class="recommend-title">Recommended Plants</div>
    <div class="plant-cards" id="plant-cards">
      <!-- Loaded from Supabase or fallback -->
    </div>
  </div>
</div>

<script>
  const SUPABASE_URL = 'https://eqhgcnzyiwgdtevxdehg.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxaGdjbnp5aXdnZHRldnhkZWhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NTcyNTgsImV4cCI6MjA4NTIzMzI1OH0.7TVUKQCStGSK5-H6eNicMHY8weOo8eAtEdDpbROX810';

  let scanStep = 0;
  let scanInterval;

  // ── SHOW / HIDE SCREENS ──
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // ── CAMERA ──
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }
      });
      document.getElementById('video').srcObject = stream;
      showScreen('screen-scan');
      startScanSequence();
    } catch (e) {
      console.error(e);
      showScreen('screen-permission');
    }
  }

  async function requestCamera() {
    await startCamera();
  }

  // ── SCAN SEQUENCE ──
  function startScanSequence() {
    scanStep = 0;

    // Show reticle initially
    setTimeout(() => {
      document.getElementById('progress-card').classList.add('show');
      updateProgress(1);
    }, 2000);

    setTimeout(() => {
      showMovement('forward');
      updateProgress(1);
    }, 3000);

    setTimeout(() => {
      hideMovement();
      showPlant();
      updateProgress(2);
    }, 5000);

    setTimeout(() => {
      showMovement('left');
    }, 6000);

    setTimeout(() => {
      hideMovement();
      updateProgress(3);
    }, 8000);

    setTimeout(() => {
      document.getElementById('progress-card').classList.remove('show');
      document.getElementById('location-banner').classList.add('show');
    }, 9000);
  }

  function updateProgress(step) {
    const subs = ['1/3 surface Detected', '2/3 surface Detected', '3/3 surface Detected'];
    document.getElementById('progress-sub').textContent = subs[step - 1];

    for (let i = 1; i <= 3; i++) {
      const dot = document.getElementById(`dot-${i}`);
      dot.className = 'progress-dot';
      if (i < step) dot.classList.add('done');
      else if (i === step) dot.classList.add('active');
    }
  }

  function showPlant() {
    document.getElementById('surface-plane').classList.add('show');
    document.getElementById('ar-plant').classList.add('show');
    document.getElementById('reticle').style.opacity = '0.3';
  }

  function showMovement(dir) {
    const toast = document.getElementById('movement-toast');
    const title = document.getElementById('toast-title');
    const icon = document.getElementById('toast-icon');

    if (dir === 'forward') {
      title.textContent = 'Move forward 12cm';
      icon.innerHTML = `<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5L12 3m0 0l7.5 7.5M12 3v18" /></svg>`;
      document.getElementById('arrows-forward').classList.add('show');
    } else {
      title.textContent = 'Move left 12cm';
      icon.innerHTML = `<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" /></svg>`;
      document.getElementById('arrows-left').classList.add('show');
    }
    toast.classList.add('show');
  }

  function hideMovement() {
    document.getElementById('movement-toast').classList.remove('show');
    document.getElementById('arrows-forward').classList.remove('show');
    document.getElementById('arrows-left').classList.remove('show');
  }

  function nextScanStep() {
    scanStep = Math.min(scanStep + 1, 2);
    updateProgress(scanStep + 1);
  }

  // ── NAVIGATION ──
  function goToCustomize() {
    showScreen('screen-customize');
  }

  function goToRecommend() {
    showScreen('screen-recommend');
    loadPlants();
  }

  function closeAR() {
    window.history.back();
    setTimeout(() => window.close(), 300);
  }

  // ── SLIDER ──
  function updateSlider(input) {
    const val = input.value;
    document.getElementById('size-label').textContent = val + '%';
    document.getElementById('slider-fill').style.width = val + '%';
    document.getElementById('slider-thumb').style.left = val + '%';
  }

  // ── POT SELECTION ──
  function selectPot(btn) {
    document.querySelectorAll('.pot-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }

  // ── LOAD PLANTS FROM SUPABASE ──
  async function loadPlants() {
    const container = document.getElementById('plant-cards');
    container.innerHTML = '<div style="color:rgba(255,255,255,0.4);font-size:14px;padding:20px 0;">Loading plants…</div>';

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/plant_scans?select=plant_name,health_status,care_tips&order=created_at.desc&limit=6`, {
        headers: {
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json'
        }
      });

      const data = await res.json();

      if (data && data.length > 0) {
        renderPlants(data);
      } else {
        renderFallbackPlants();
      }
    } catch (e) {
      renderFallbackPlants();
    }
  }

  function renderPlants(plants) {
    const container = document.getElementById('plant-cards');
    container.innerHTML = '';

    plants.forEach(plant => {
      const card = document.createElement('div');
      card.className = 'plant-card';
      const tip = plant.care_tips?.[0] ?? 'Keep in indirect sunlight and water weekly';
      card.innerHTML = `
        <svg class="plant-card-img" viewBox="0 0 100 100" fill="none">
          <circle cx="50" cy="85" rx="18" ry="5" fill="#8B7355" opacity="0.3"/>
          <path d="M44 85 L46 98 L54 98 L56 85 Z" fill="#A0856A"/>
          <ellipse cx="50" cy="85" rx="12" ry="3" fill="#B8966E"/>
          <path d="M50 85 L50 60" stroke="#4A7C59" stroke-width="3" stroke-linecap="round"/>
          <path d="M50 70 Q35 58 28 44 Q42 48 50 65" fill="#2E7D32"/>
          <path d="M50 65 Q65 52 72 38 Q58 44 50 62" fill="#388E3C"/>
          <path d="M50 62 Q46 50 50 38 Q54 50 50 62" fill="#66BB6A"/>
        </svg>
        <div class="plant-card-name">${plant.plant_name ?? 'Unknown Plant'}</div>
        <div class="plant-card-status">${plant.health_status ?? 'Healthy'}</div>
        <div class="plant-card-desc">${tip.substring(0, 50)}${tip.length > 50 ? '…' : ''}</div>
      `;
      container.appendChild(card);
    });
  }

  function renderFallbackPlants() {
    const plants = [
      { name: 'Rubber Plant', status: 'Healthy', desc: 'Thrives in indirect light, water every 1–2 weeks' },
      { name: 'Peace Lily', status: 'Healthy', desc: 'Low light tolerant, keep soil moist' },
      { name: 'Pothos', status: 'Healthy', desc: 'Very easy care, tolerates low light well' },
      { name: 'Snake Plant', status: 'Healthy', desc: 'Drought tolerant, perfect for beginners' },
    ];

    const container = document.getElementById('plant-cards');
    container.innerHTML = '';

    plants.forEach(p => {
      const card = document.createElement('div');
      card.className = 'plant-card';
      card.innerHTML = `
        <svg class="plant-card-img" viewBox="0 0 100 100" fill="none">
          <circle cx="50" cy="85" rx="18" ry="5" fill="#8B7355" opacity="0.3"/>
          <path d="M44 85 L46 98 L54 98 L56 85 Z" fill="#A0856A"/>
          <ellipse cx="50" cy="85" rx="12" ry="3" fill="#B8966E"/>
          <path d="M50 85 L50 60" stroke="#4A7C59" stroke-width="3" stroke-linecap="round"/>
          <path d="M50 70 Q35 58 28 44 Q42 48 50 65" fill="#2E7D32"/>
          <path d="M50 65 Q65 52 72 38 Q58 44 50 62" fill="#388E3C"/>
          <path d="M50 62 Q46 50 50 38 Q54 50 50 62" fill="#66BB6A"/>
        </svg>
        <div class="plant-card-name">${p.name}</div>
        <div class="plant-card-status">${p.status}</div>
        <div class="plant-card-desc">${p.desc}</div>
      `;
      container.appendChild(card);
    });
  }

  // ── INIT ──
  window.addEventListener('load', async () => {
    // Try camera immediately
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment' }
      });
      document.getElementById('video').srcObject = stream;
      setTimeout(() => {
        showScreen('screen-scan');
        startScanSequence();
      }, 1500);
    } catch (e) {
      setTimeout(() => showScreen('screen-permission'), 1500);
    }
  });
</script>
</body>
</html>